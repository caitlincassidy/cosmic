<!DOCTYPE html>
<html>

<head>
<meta charset="utf-8">
<title>Cosmic</title>

<!-- Load style sheets -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.3.1/fullcalendar.min.css">
<link rel="styleheet" href="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.3.1/fullcalendar.print.css">

<link href="https://fonts.googleapis.com/css?family=Cairo|Gentium+Basic|Roboto" rel="stylesheet">

 <link rel="stylesheet" href="css/mainLayout.css">

<!-- Use mobile-aware viewport -->
<meta name="viewport" content=
  "width=device-width, initial-scale=1, shrink-to-fit=no">

<!-- Load any supplemental Javascript libraries here -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.1/moment.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.3.1/fullcalendar.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

<script src="http://www.eyecon.ro/bootstrap-datepicker/js/bootstrap-datepicker.js"></script>

  <!-- Include Date Range Picker -->
  <script type="text/javascript" src="https://cdn.jsdelivr.net/bootstrap.daterangepicker/2/daterangepicker.js"></script>
  <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/bootstrap.daterangepicker/2/daterangepicker.css" />

  <!-- Custom scripts -->
  <script src="js/load-task-data.js"></script>
  <script src="js/load-header.js" defer></script>


</head>

<body>

<script>

  // Add a new task to the page under the correct heading
  var makeTaskDom = function(task) {
    // Two columns, one for task text and one for due date
    var taskDivString = `
      <div class="row task-item">
        <div class="col-xs-9 text"></div>
        <div class="col-xs-3 due"></div>
      </div>
    `;
    var taskDiv = $.parseHTML(taskDivString);

    // Store task information for later
    $(taskDiv).data('task-json', task);

    // Task text
    var textElt = $('<p>', {
                text: task.text,
            });
    var checkbox = $('<input/>', {
      type: "checkbox",
    });
    checkbox.css("margin-right", "10px");
    textElt.prepend(checkbox);
    textElt.appendTo($(taskDiv).children()[0]);

    // Task due date
    // Figure out what due date text to display
    // Use mm/dd/yyyy format so it's only comparing days,
    // not hours or minutes
    var daysUntilDue = moment(task.due).diff(moment().format("MM/DD/YYYY"), 'days');
    var dueDateText;
    // Store all upcoming tasks so they can be sorted and displayed correctly later
    var upcomingTasks = [];
    if (daysUntilDue < 0) { // Task is outstanding
      if (daysUntilDue == -1) { // Handle singular case
        dueDateText = "1 day late";
      } else {
        dueDateText = Math.abs(daysUntilDue) + " days late";
      }
    } else if (daysUntilDue == 0) { // Task is due today
      dueDateText = "Today";
    } else { // Task is upcoming
      upcomingTasks.push(task);
      if (daysUntilDue == 1) {
        dueDateText = "Tomorrow";
      } else if (daysUntilDue <= 7) {
        dueDateText = "In " + daysUntilDue + " days";
      } else {
        // If it's far enough in the future, just display the date
        dueDateText = moment(task.due).format("MM/DD/YYYY");
      }
    }

    var dueElt = $('<p>', {
                text: dueDateText,
            });
    dueElt.appendTo($(taskDiv).children()[1]);


    return taskDiv;

    // TODO: Append to div
    // Go through DOM utnil its date is earlier?
    /*
    var allTasks = $(document).find(".task-item");
    console.log(allTasks);
    var i = 0;
    if (allTasks.length > 0) {

    } else {

    }
    var lastEarlierRow = allTasks[0];
    */


    // TODO: Put it in the right place


    //taskElt.append($('<span/>', {
    //  class: "glyphicon glyphicon-pencil",
    //}));

    // TODO: find the right place to append it
    // probably depends on how we want to animate it
    // and depends on local storage

    // Make this new task hover-able
    //addHoverHandlers();
  }

  $(document).ready(function() {
    console.log("document is ready");
    // Load tasks from storage and display them
    var sampleTasks = JSON.parse(window.localStorage.getItem("tasks"));
    // Sort latest to earliest so they're appended correctly
    sampleTasks.sort(function(a, b) {
      // Should return negative if a is later than b
      return moment(b.due).diff(moment(a.due));
    });
    console.log(sampleTasks);

    sampleTasks.forEach(function(task) {
      var taskDom = makeTaskDom(task);
      // Add it under correct heading
      var daysUntilDue = moment(task.due).diff(moment().format("MM/DD/YYYY"), 'days');
      var headingId;
      if (daysUntilDue < 0) {
        headingId = "#outstanding";
      } else if (daysUntilDue == 0) {
        headingId = "#due-today";
      } else {
        headingId = "#upcoming";
      }
      $(headingId).after(taskDom);
    });
  })


</script>

<script>
	$(document).ready(function() {
		
		
// From http://zurb.com/building-blocks/sticky-sidebar
	var stickySidebar = $('.sticky');

	if (stickySidebar.length > 0) { 
	  var stickyHeight = stickySidebar.height(),
		  sidebarTop = stickySidebar.offset().top;
	}

	// on scroll move the sidebar
	$(window).scroll(function () {
	  if (stickySidebar.length > 0) { 
		var scrollTop = $(window).scrollTop();

		if (sidebarTop < scrollTop) {
		  stickySidebar.css('top', scrollTop - sidebarTop);

		  // stop the sticky sidebar at the footer to avoid overlapping
		  var sidebarBottom = stickySidebar.offset().top + stickyHeight,
			  stickyStop = $('.main-content').offset().top + $('.main-content').height();
		  if (stickyStop < sidebarBottom) {
			var stopPosition = $('.main-content').height() - stickyHeight;
			stickySidebar.css('top', stopPosition);
		  }
		}
		else {
		  stickySidebar.css('top', '0');
		} 
	  }
	});

	$(window).resize(function () {
	  if (stickySidebar.length > 0) { 
		stickyHeight = stickySidebar.height();
	  }
	});	
	
	});
</script>	
	

  <script>
    // Remove a task
    $(document).on('click', ":checkbox", function(evt) {
      $(this).parent().fadeOut(
        400,
        function() {
          // Remove dom element
          $(this).remove();
        }
      );
    });
          // TODO(GR5): Make it undo-able

    $(document).ready(function() {
      $("#new_task_due_date").daterangepicker({
        "applyClass": "btn-primary",
        "singleDatePicker": true,
        "startDate": moment().format("MM/DD/YYYY"),
      });
    });

    // Make new task dropdown display the selected event
    // Source: http://stackoverflow.com/questions/13437446/how-to-display-selected-item-in-bootstrap-button-dropdown-title
    $(document).on('click', ".dropdown-menu li a", function() {
      $("#event-name").text($(this).text());
      $("#event-name").val($(this).text());
      // Keeps the caret down displayed
      $('#event-name').html($(this).text() + ' <span class="caret"></span>');
    });

  </script>


	<div class="container-fluid">
		<div class="row main-header">
      <div class="col-lg-2"></div>
    </div>
  	<div class="row">
  		<div class="col-lg-2" id="menubar">
  		</div>
  		<div class="col-lg-10">
        <div class="page-header">
          <h1>
            <span class="glyphicon glyphicon-list" aria-hidden="true"></span> Tasks
          </h1>
        </div>

        <div class="page-content main-content row">
          <div class="col-lg-8">

            <h3 id="outstanding"> Outstanding </h3>

            <h3 id="due-today"> Due today </h3>

            <h3 id="upcoming"> Upcoming </h3>


            <!--
            <p class="task-item"><input type="checkbox"></input> Email John about reserving space for final exam <span class="glyphicon glyphicon-menu-hamburger"></span></p>
            <p class="task-item"><input type="checkbox"></input> Make the beta for Quiz 1 <span class="glyphicon glyphicon-menu-hamburger"></span></p>

            <br>
            <h2> Due today (April 20) </h2>

            <p class="task-item"><input id="checkbox-ask-availability" type="checkbox"></input> Ask TAs when they're available to host a Quiz 1 review session <span class="glyphicon glyphicon-menu-hamburger"></span></p>

            <p class="task-item"><input type="checkbox"></input> Pick up quiz materials from CopyTech <span class="glyphicon glyphicon-menu-hamburger"></span></p>

            <p class="task-item"><input type="checkbox"></input> Remind students that Quiz 1 is coming up in two weeks <span class="glyphicon glyphicon-menu-hamburger"></span></p>
            
            <br>
            <h2> Due tomorrow (April 21) </h2>

            <p> Nothing! :D </p>
            
            <br>
            <h2> Due April 22 </h2>

            <p class="task-item"><input type="checkbox"></input> Send Quiz 1 beta to TAs for testing  <span class="glyphicon glyphicon-menu-hamburger"></span></p>

            <p class="task-item"><input type="checkbox"></input> Review notes for Lecture 13  <span class="glyphicon glyphicon-menu-hamburger"></span></p>

            <p class="task-item"><input type="checkbox"></input> Review notes for Lecture 14  <span class="glyphicon glyphicon-menu-hamburger"></span></p>

          -->


          </div>
          <div class="col-lg-3 panel sticky" id="sidebar">
				  
            <h2> Add new task </h2>

            <!-- Task text -->
            <div class="form-group">
              <textarea class="form-control" rows="2" placeholder="Task to add"></textarea>
            </div>

            <!-- Date it's due -->
            <div class="form-group">
                <input type='text' class="form-control" placeholder="Due date" id="new_task_due_date"/>
            </div>


            <!-- Event dropdown -->
            <div class="dropdown">
              <button class="btn btn-default dropdown-toggle" type="button" id="event-name" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
                Event Name
                <span class="caret"></span>
              </button>

              <ul class="dropdown-menu" aria-labelledby="event-name">
                <li><a href="#">None</a></li>
                <li role="separator" class="divider"></li>
                <li><a href="#">Quiz 1</a></li>
                <li role="separator" class="divider"></li>
                <li><a href="#">Lecture 1</a></li>
                <li><a href="#">Lecture 2</a></li>
                <li role="separator" class="divider"></li>
                <li><a href="#">Lab 1</a></li>
                <li><a href="#">Lab 2</a></li>
                <li><a href="#">Lab 3</a></li>
                <li><a href="#">Lab 4</a></li>
                <li><a href="#">Lab 5</a></li>
              </ul>
            </div>

            <br />

            <button type="button" class="btn btn-default" style="float: right">Create</button>

		  </div>
          <!-- Margin column -->
          <div class="col-lg-1">
          </div>



        </div> <!-- class=page-content -->


  	</div> <!-- class="row" -->
	</div> <!-- class="container" -->

  <script id="load-menubar-script" src="js/load-menubar.js" link="tasks.html"></script>

</body>

</html>

<!-- TODO(GR5): Make checkboxes + hamburger button work -->